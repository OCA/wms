!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):(t=t||self,e(t.Vue2Storage={}))}(this,function(t){"use strict";function e(t,e,r,n){return new(r||(r=Promise))(function(i,o){function s(t){try{u(n.next(t))}catch(t){o(t)}}function c(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(s,c)}u((n=n.apply(t,e||[])).next())})}function r(t){if(null===t||void 0===t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}var n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},r=0;r<10;r++)e["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(t){n[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var s,c,u=r(t),f=1;f<arguments.length;f++){s=Object(arguments[f]);for(var h in s)i.call(s,h)&&(u[h]=s[h]);if(n){c=n(s);for(var a=0;a<c.length;a++)o.call(s,c[a])&&(u[c[a]]=s[c[a]])}}return u};const c={};class u{get length(){return Object.keys(this.storage).length}get storage(){return c}getItem(t){return t in this.storage?this.storage[t]:null}setItem(t,e){this.storage[t]=e}removeItem(t){t in this.storage&&delete this.storage[t]}clear(){const t=Object.keys(this.storage);for(let e=0;e<=t.length;e++)try{delete this.storage[t[e]]}catch(t){}}}var f,h=new u;!function(t){t.LOCAL="local",t.SESSION="session",t.MEMORY="memory"}(f||(f={}));class a extends Error{constructor(t,e){super(t),this.name="StorageError",e&&(this.stack=e)}}class l{constructor(t={}){this.setOptions(t)}get length(){return this.keys().length}get prefix(){return this.options.prefix}get name(){return"vue2-storage"}get version(){return"5.0.0"}get driver(){switch(this.options.driver){case f.LOCAL:default:return"undefined"!=typeof window?window.localStorage:h;case f.SESSION:return"undefined"!=typeof window?window.sessionStorage:h;case f.MEMORY:return h}}setOptions(t={}){const e={prefix:"app_",driver:f.LOCAL,ttl:0},r=s(e,t);this.options=Object.freeze(r)}get(t,e=null){try{const r=this.fromJSON(this.addPrefix(t));return null===r?e:r}catch(t){this.throwError(t)}}pull(t,e=null){const r=this.get(t,e);return r!==e&&this.remove(t),r}set(t,e,r={}){try{this.driver.setItem(this.addPrefix(t),this.toJSON(e,r))}catch(t){this.throwError(t)}}remember(t,r,n={}){return e(this,void 0,void 0,function*(){let e=this.get(t,null);if(null!==e)return e;try{return e=yield r(),this.set(t,e,n),e}catch(t){this.throwError(t)}})}remove(t){try{this.driver.removeItem(this.addPrefix(t))}catch(t){this.throwError(t)}}clear(t=!1){try{if(t)this.driver.clear();else{const t=this.keys().filter(t=>t.startsWith(this.options.prefix||""));t.forEach(t=>this.remove(this.removePrefix(t)))}}catch(t){this.throwError(t)}}has(t){return this.options.driver!==f.MEMORY?this.addPrefix(t)in this.driver:this.addPrefix(t)in this.driver.storage}key(t){try{const e=this.keys()[t];return this.get(this.removePrefix(e))}catch(t){this.throwError(t)}}keys(){return this.options.driver!==f.MEMORY?Object.keys(this.driver):Object.keys(this.driver.storage)}addPrefix(t){return`${this.options.prefix||""}${t}`}removePrefix(t){const e=new RegExp(`^${this.options.prefix||""}`);return t.replace(e,"")}toJSON(t,e={}){const r="ttl"in e?e.ttl:this.options.ttl;return JSON.stringify({value:t,ttl:r>0?r+Date.now():0})}fromJSON(t){try{const e=JSON.parse(this.driver.getItem(t));return null!==e?"ttl"in e&&Number(e.ttl)>0&&Number(e.ttl)<Date.now()?(this.remove(this.removePrefix(t)),null):"value"in e?e.value:e:null}catch(t){return null}}throwError(t){throw new a(`${this.name}[${this.version}]: ${t.message}`,t.stack)}}class d{static install(t,e){const r=new l(e);t.$storage=r,t.prototype.$storage=r}}"undefined"!=typeof window&&(window.Vue2Storage=d),t.Vue2Storage=d,t.default=d,Object.defineProperty(t,"__esModule",{value:!0})});
